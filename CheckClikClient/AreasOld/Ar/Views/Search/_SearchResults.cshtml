@using Customer
@using SearchLibrary
@using SearchLibrary.Models
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

@model QueryResponse<ProductSearchResult>
@{
    string strApiURL = Configuration["apiurl"];
    double maxPrice = 0;
    double minPrice = 0;
}

@if (Model != null)
{
        <div class="container mb-30">
                <div class="row flex-row-reverse">
                    <div class="col-lg-4-5">
                        <div class="shop-product-fillter">
                            <div class="totall-product">
                                <p>We found 
                                    <strong id="1" class="srgtxt text-brand">@Model.NumFound</strong><strong  class="text-brand"> @(Model.NumFound == 1 ? "ITEM" : "ITEMS") IN </strong>
                                    <strong id="2" class="srgtxt text-brand">@Model.NGroups</strong><strong class="text-brand"> @(Model.NGroups == 1 ? "STORE" : "STORES") </strong>
                                    @*<strong class="text-brand">29</strong> *@
                                    items for you!
                                </p>
                            </div>
                            <div class="sort-by-product-area"> 
                                <div class="sort-by-cover mr-10">
                                    <div class="sort-by" style="border: 1px solid #ececec; color: #777;padding: 9px 16px;border-radius: 10px;">
                                        <span><i class="fi-rs-apps mr-1"></i>&nbsp;&nbsp; Show:</span>

                                        <select id="ddlShow" name="ddlShow" class="" style="width:auto; "> 
                                            <option value="10">10</option>
                                            <option value="15">15</option>
                                            <option value="15">20</option>
                                            <option value="30">30</option>
                                        </select>
                                    </div>
                                </div> 
                                @*<div class="sort-by-cover mr-10">
                                    @{
                                        string sortLabel = "Relevence";
                                        if (Model.OriginalQuery != null)
                                        {
                                            if (!string.IsNullOrWhiteSpace(Model.OriginalQuery.SortField))
                                            {
                                                if (Model.OriginalQuery.SortField.ToLower() == "price")
                                                {
                                                    sortLabel = Model.OriginalQuery.SortDirection == "asc" ? "Price: Low to High" : "Price: High to Low";
                                                }
                                            }
                                        }

                                    }
                                    <div class="navbar-right filters-right text-right">
                                        <span>
                                            <strong>SORT BY:</strong> &ensp;
                                            <div class="btn-group">
                                                <button type="button" class="form-control btn filter-dropdown btn-default dropdown-toggle" data-toggle="dropdown">
                                                    @sortLabel<span class="caret"></span>
                                                </button>
                                                <ul class="delivery-filter dropdown-menu" role="menu">
                                                    @if (sortLabel != "Price: Low to High")
                                                    {
                                                        <li><a href="#" class="search-sort" data-sort-field="Price" data-sort-dir="asc">Price: Low to High</a></li>
                                                    }
                                                    @if (sortLabel != "Price: High to Low")
                                                    {
                                                        <li><a href="#" class="search-sort" data-sort-field="Price" data-sort-dir="desc">Price: High to Low</a></li>
                                                    }
                                                    @if (sortLabel != "Relevence")
                                                    {
                                                        <li><a href="#" class="search-sort" data-sort-field="Relevence" data-sort-dir="asc">Relevence</a></li>
                                                    }
                                                </ul>
                                            </div>
                                        </span>
                                    </div>
                                </div>*@ 
                                @*<div class="sort-by-cover">
                                    <div class="sort-by-product-wrap">
                                        <div class="sort-by">
                                            <span><i class="fi-rs-apps-sort"></i>Sort by:</span>
                                        </div>
                                        <div class="sort-by-dropdown-wrap">
                                            <span> Featured <i class="fi-rs-angle-small-down"></i></span>
                                        </div>
                                    </div>
                                    <div class="sort-by-dropdown">
                                        <ul>
                                            <li><a class="active" href="#">Featured</a></li>
                                            <li><a href="#">Price: Low to High</a></li>
                                            <li><a href="#">Price: High to Low</a></li>
                                            <li><a href="#">Release Date</a></li>
                                            <li><a href="#">Avg. Rating</a></li>
                                        </ul>
                                    </div>
                                </div>*@
                            </div>
                        </div>
                        <div class="row product-grid">
                            
                            <div id="searchResultItems" class="row">
                                @if (Model.Results != null)
                                {
                                    for (int i = 0; i < Model.Results.Count; i++)
                                    { 
                                        
                            <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                                <div class="product-cart-wrap mb-30">
                                    <div class="product-img-action-wrap">
                                        <div class="product-img product-img-zoom">
                                            <a href="shop-product-right.html">
                                                <img class="default-img" src="@Url.Content(strApiURL + "Uploads/Products/" + Model.Results[i].ProductMainImage)" alt="" style="height: 200px;" />
                                                <img class="hover-img" src="@Url.Content(strApiURL + "Uploads/Products/" + Model.Results[i].ProductMainImage)" alt=""  style="height: 200px;"/>
                                            </a>
                                        </div>
                                        <div class="product-action-1">
                                            <a aria-label="Add To Wishlist" class="action-btn" href="shop-wishlist.html"><i class="fi-rs-heart"></i></a>
                                            <a aria-label="Compare" class="action-btn" href="shop-compare.html"><i class="fi-rs-shuffle"></i></a>
                                            <a aria-label="Quick view" class="action-btn" data-bs-toggle="modal" data-bs-target="#quickViewModal"><i class="fi-rs-eye"></i></a>
                                        </div>
                                        @*<div class="product-badges product-badges-position product-badges-mrg">
                                            <span class="best">-14%</span>
                                        </div>*@
                                    </div>
                                    <div class="product-content-wrap">
                                        <div class="product-category">
                                            <a href="#">@Model.Results[i].StoreNameEn</a>
                                        </div>
                                        <h2><a href="#">@Model.Results[i].NameEn</a></h2>
                                        @*<div class="product-rate-cover">
                                            <div class="product-rate d-inline-block">
                                                <div class="product-rating" style="width: 90%"></div>
                                            </div>
                                            <span class="font-small ml-5 text-muted"> (4.0)</span>
                                        </div>*@
                                        <div>
                                            <span class="font-small text-muted">Branch: <a href="#">@Model.Results[i].BranchNameEn @(Model.Results[i].DistToStoreBranch != null ? string.Concat(Math.Round(Convert.ToDecimal(Model.Results[i].DistToStoreBranch), 2).ToString(), " km") : "")</a></span>
                                        </div>
                                        <div class="product-card-bottom">
                                            <div class="product-price">
                                                <span>@Model.Results[i].Price.ToString("#,###,###,##0.00") SAR</span>
                                                <span class="old-price">@Model.Results[i].SellingPrice.ToString("#,###,###,##0.00") SAR</span>
                                            </div>
                                            @{
                                                var MainCategory = Model.Results[i].OtherFields.Where(x => x.Key == "BranchCategoryEn").Select(x => x.Value).First().ToString();
                                                var SubCategory = Model.Results[i].OtherFields.Where(x => x.Key == "BranchSubCategoryEn").Select(x => x.Value).First().ToString();
                                            }
                                            <div class="add-cart">
                                                @if (Model.Results[i].ItemType.ToUpper() == "P")
                                                {
                                                    <a href="~/@Model.Results[i].StoreNameEn.Replace(" ","-").ToLower()/@MainCategory.Replace(" ","-").ToLower()/@SubCategory.Replace(" ","-").ToLower()/p/@SlugUtil.GenerateSlug(Model.Results[i].ProductBranchId, Model.Results[i].NameEn, Model.Results[i].ProductSKUId, Convert.ToInt32(Model.Results[i].ProductId), Model.Results[i].UPCBarcode,Model.Results[i].BranchId)" class="add"><i class="fi-rs-shopping-cart mr-5"></i>Add</a>
                                                }
                                                else
                                                {
                                                    <a href="~/@Model.Results[i].StoreNameEn.Replace(" ","-").ToLower()/@MainCategory.Replace(" ","-").ToLower()/@SubCategory.Replace(" ","-").ToLower()/s/@SlugUtil.GenerateSlugService(Model.Results[i].NameEn,Model.Results[i].BranchId,Convert.ToInt32(Model.Results[i].ProductId))" class="add"><i class="fi-rs-shopping-cart mr-5"></i>Add</a>
                                                }
                                                @*<a class="add" href="shop-cart.html"><i class="fi-rs-shopping-cart mr-5"></i>Add </a>*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> 





                                             
                                    }
                                    if (Model.Results.Count == 0)
                                    {
                                        <div class="row product-grid">
                                                <div class="archive-header-2 text-center">
                                                    <h1 class="display-2 mb-50">No Store Found.</h1> 
                                                </div> 
                                        </div>
                                    }
                                }
                                
                            </div> 
                        </div>
                        <!--product grid-->
                        <div class="pagination-area mt-20 mb-20">
                            @*<div class="row">
                                    <div class="col-sm-12">
                                        <ul class="pagination">
                                            @{
                                                int iPageSize = Customer.Utils.SearchUtil.PageSize;
                                                int iMaxPages = (Model.NGroups + iPageSize - 1) / iPageSize;
                                                ///if (iMaxPages > 1)
                                                //{
                                                for (int i = 1; i <= iMaxPages; i++)
                                                {
                                                        <li><a href="javascript:void(0);" class="changePage" data-pageindex="@(i - 1)">@i</a></li>
                                                }
                                                //}
                                            }
                                        </ul>
                                    </div>
                                </div> *@
                            <nav aria-label="Page navigation example">
                                <ul class="pagination justify-content-start">
                                    <li class="page-item">
                                        <a class="page-link" href="#"><i class="fi-rs-arrow-small-left"></i></a>
                                    </li>
                                            @{
                                                int iPageSize = Customer.Utils.SearchUtil.PageSize;
                                                int iMaxPages = (Model.NGroups + iPageSize - 1) / iPageSize;
                                                ///if (iMaxPages > 1)
                                                //{
                                                for (int i = 1; i <= iMaxPages; i++)
                                                {
                                                    <li class="page-item"><a href="javascript:void(0);" class="page-link changePage" data-pageindex="@(i - 1)">@i</a></li> 

                                                        //<li><a href="javascript:void(0);" class="changePage" data-pageindex="@(i - 1)">@i</a></li>
                                                }
                                                //}
                                            }
                                    
                                    <li class="page-item">
                                        <a class="page-link" href="#"><i class="fi-rs-arrow-small-right"></i></a>
                                    </li>
                                </ul>
                            </nav>
                        </div> 
                        <!--End Deals-->
                    </div>

                    <div class="col-lg-1-5 primary-sidebar sticky-sidebar"> 
                        <!-- Fillter By Price -->
                        <div class="sidebar-widget price_range range mb-30">
                            <h5 class="section-title style-1 mb-30">Filter By</h5>
                            <div class="price-filter">
                                <div class="price-filter-inner">
                                    <label class="fw-900">Filter By Price</label>
                                    <div id="slider-range" class="mb-20"></div>
                                    <div class="d-flex justify-content-between">
                                         @if (Model.Results != null)
                                        {
                                            if (Model.OriginalResultsCount > 0)
                                            {
                                        @*<header class="card-header">
                                                    <h6 class="title">PRICE</h6>
                                                </header>
                                                <div class="card-body">
                                                    @if (Model.MinPrice + "," + Model.MaxPrice != Model.OriginalPriceRange)
                                                    {
                                                        <a id="lnkClearPriceFilter" href="javascript:void(0)">Clear</a>
                                                    }
                                                    <input id="txtPriceRange" type="text" data-slider-min="@Model.MinPrice" data-slider-max="@Model.MaxPrice" data-slider-value="[@Model.OriginalPriceRange]" />
                                                    <div>
                                                        Min: <span id="spnMinPrice" />
                                                        <span class="pull-right">Max: <span id="spnMaxPrice" /></span>
                                                    </div>
                                                </div>*@
                                        maxPrice = @Model.MaxPrice;
                                        minPrice = @Model.MinPrice;
                                    }
                                        }
                                        <div class="caption">From: <strong id="slider-range-value1" class="text-brand"></strong></div>
                                        <div class="caption">To: <strong id="slider-range-value2" class="text-brand"></strong></div>
                                    </div>
                                </div>
                            </div>
                            <div class="list-group">
                                <div class="list-group-item mb-10 mt-10">

                                    @{//need to check this block.
                                bool isMultipleItemTypes = false;
                                if (Model.Facets != null)
                                {
                                    FacetsResponse faItemType = Model.Facets.FirstOrDefault(f => f.FacetEn == "ItemType");
                                    if (faItemType != null)
                                    {
                                        if (faItemType.FacetFilters.Count > 1)
                                        {
                                            isMultipleItemTypes = true;
                                            FacetItem faProducts = faItemType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "P");
                                            FacetItem faServices = faItemType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "S");
                                                <header class="card-header">
                                                    <h6 class="title">ITEM TYPE</h6>
                                                </header>
                                                <div class="card-body">
                                                    @if (faProducts != null)
                                                {
                                                    if (faServices != null)
                                                    {
                                                        if (faProducts.Selected || faServices.Selected)
                                                        {
                                                                @:<a id="lnkClearItemType" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                        }
                                                    }
                                                        <div class="custom-control">
                                                            <span class="pull-right badge badge-light round">@faProducts.Count</span>
                                                            @Html.RadioButton("ckbFilterItemTypeP", faProducts.FacetText, faProducts.Selected, new { @class = "custom-control-input optItemType", @Name = "optItemType" })
                                                            <label for="ckbFilterItemTypeP" class="custom-control-label">Products</label>
                                                        </div> <!-- form-check.// -->
                                                }
                                                    @if (faServices != null)
                                                {
                                                        <div class="custom-control">
                                                            <span class="pull-right badge badge-light round">@faServices.Count</span>
                                                            @Html.RadioButton("ckbFilterItemTypeS", faServices.FacetText, faServices.Selected, new { @class = "custom-control-input optItemType", @Name = "optItemType" })
                                                            <label for="ckbFilterItemTypeS" class="custom-control-label">Services</label>
                                                        </div> <!-- form-check.// -->
                                                }
                                                </div>
                                        }
                                    }
                                }
                            }

                               @{
                                if (Model.Facets != null)
                                {
                                    List<FacetsResponse> lstDynamicFacets = Model.Facets.Where(f => f.FacetEn == "ManufacturerEn" || f.Id != 0).ToList();
                                    for (int i = 0; i < lstDynamicFacets.Count; i++)
                                    {
                                        //<header class="card-header">
                                        //    <h6 class="title">@(lstDynamicFacets[i].FacetEn == "ManufacturerEn" ? "BRAND" : lstDynamicFacets[i].FacetEn.ToUpper())</h6>
                                        //</header>
                                            <label class="fw-900">@(lstDynamicFacets[i].FacetEn == "ManufacturerEn" ? "BRAND" : lstDynamicFacets[i].FacetEn.ToUpper())</label>
                                        //<div class="card-body">
                                            
                                                FacetsResponse currentFacetFilters = null;

                                                if (lstDynamicFacets[i].FacetEn == "ManufacturerEn")
                                                {
                                                    currentFacetFilters = Model.Facets.FirstOrDefault(f => f.FacetEn == lstDynamicFacets[i].FacetEn);
                                                }
                                                else
                                                {
                                                    currentFacetFilters = Model.Facets.FirstOrDefault(f => f.Id == lstDynamicFacets[i].Id);
                                                }

                                                //if (currentFacetFilters != null)
                                                //{
                                                //    if (currentFacetFilters.FacetFilters.Any(ff => ff.Selected == true))
                                                //    {
                                                //        @:<a id="@string.Concat("lknClear_", lstDynamicFacets[i].Id)" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                //    }
                                                //}
                                            
                                                @foreach (var facetFilterItems in currentFacetFilters.FacetFilters)
                                            {
                                                    <div class="custome-checkbox">
                                                        <input class="form-check-input  ckbFilter filter-auto" type="checkbox" name="@string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId)" id="@string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId)" checked="@facetFilterItems.Selected" value="" />
                                                        <label class="form-check-label" for="@string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId)"><span>@(facetFilterItems.FacetText.ToTitleCase())</span></label>
                                                        <br /> 
                                                    </div>
                                                //<div class="custom-control custom-checkbox">
                                                //    <span class="pull-right badge badge-light round">@facetFilterItems.Count</span>
                                                //    @Html.CheckBox(string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId), facetFilterItems.Selected, new { @class = "custom-control-input ckbFilter filter-auto" })
                                                //    <label for="@string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId)" class="custom-control-label">@(facetFilterItems.FacetText.ToTitleCase())</label>
                                                //</div> <!-- form-check.// -->
                                            }
                                        //</div>
                                    }
                                }
                            }

                             @if (Model.Results != null)
                            {
                                if (Model.OriginalResultsCount > 0)
                                { 
                                     bool IsDeliveryType = true; bool IsServiceType = false;

                                     if (!isMultipleItemTypes)
                                        {
                                            if (Model.Results.Count > 0)
                                            {
                                                if (Model.Results[0].ItemType == "S")
                                                {
                                                    IsServiceType = true;
                                                    IsDeliveryType = false;
                                                }
                                            }
                                        }
                                     else
                                        {
                                            IsServiceType = true;
                                        }

                                     if (!string.IsNullOrWhiteSpace(Model.StaticFacets.ItemType))
                                        {
                                            IsDeliveryType = Model.StaticFacets.ItemType != "S";
                                            IsServiceType = !IsDeliveryType;
                                        }


                                    <label class="fw-900 mt-15">PAYMENT METHOD</label> 
                                    <div class="custome-checkbox">
                                        @Html.CheckBoxFor(model => model.StaticFacets.IsCOD, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbPaymentCOD", Name = "ckbPaymentCOD" }) 
                                        <label class="form-check-label" for="ckbPaymentCOD"><span>Cash On Delivery</span></label>
                                        <br /> 
                                    </div>

                                    <label class="fw-900 mt-15">CREDIT CARD</label> 
                                    <div class="custome-checkbox">
                                        @Html.CheckBoxFor(model => model.StaticFacets.IsCCPN, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbPaymentCrPayNow", Name = "ckbPaymentCrPayNow" }) 
                                        <label class="form-check-label" for="ckbPaymentCrPayNow"><span>Pay Now</span></label>
                                        <br /> 
                                        @Html.CheckBoxFor(model => model.StaticFacets.IsCCPL, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbPaymentCrPayLater", Name = "ckbPaymentCrPayLater" }) 
                                        <label class="form-check-label" for="ckbPaymentCrPayLater"><span>Pay Later</span></label>
                                        <br /> 
                                    </div> 

                                    <label class="fw-900 mt-15">DEBIT CARD</label> 
                                    <div class="custome-checkbox">
                                        @Html.CheckBoxFor(model => model.StaticFacets.IsDCPN, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbPaymentDrPayNow", Name = "ckbPaymentDrPayNow" }) 
                                        <label class="form-check-label" for="ckbPaymentDrPayNow"><span>Pay Now</span></label>
                                        <br /> 
                                        @Html.CheckBoxFor(model => model.StaticFacets.IsDCPL, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbPaymentDrPayNow", Name = "ckbPaymentDrPayNow" }) 
                                        <label class="form-check-label" for="ckbPaymentDrPayNow"><span>Pay Later</span></label>
                                        <br /> 
                                    </div> 
                                 


                                        if (IsDeliveryType)
                                        {
                                            <label class="fw-900 mt-15">DELIVERY</label> 
                                            <div class="custome-checkbox">
                                                @Html.CheckBoxFor(model => model.StaticFacets.IsPickup, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbIsPickup", Name = "ckbIsPickup" }) 
                                                <label class="form-check-label" for="ckbIsPickup"><span>Pickup</span></label>
                                                <br /> 
                                                @Html.CheckBoxFor(model => model.StaticFacets.IsDelivery, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbIsDelivery", Name = "ckbIsDelivery" }) 
                                                <label class="form-check-label" for="ckbIsDelivery"><span>Delivery</span></label>
                                                <br /> 
                                                @Html.CheckBoxFor(model => model.StaticFacets.IsShipping, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbIsShipping", Name = "ckbIsShipping" }) 
                                                <label class="form-check-label" for="ckbIsShipping"><span>Shipping</span></label>
                                                <br /> 
                                            </div> 
                                        }

                                        if (IsServiceType)
                                        {
                                            FacetsResponse faServiceType = Model.Facets.FirstOrDefault(f => f.FacetEn == "ServiceType");
                                            if (faServiceType != null)
                                            {
                                                //To dynamically dispaly service type filters
                                                if (faServiceType.FacetFilters.Where(ff => ff.FacetText != "0").Count() > 0)
                                                {
                                                    FacetItem faHomeService = faServiceType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "1");
                                                    FacetItem faStoreService = faServiceType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "2");

                                                    
                                                            bool IsHomeSelected = false; bool IsStoreSelected = false;
                                                            if (faHomeService != null)
                                                            {
                                                                IsHomeSelected = faHomeService.Selected;
                                                            }
                                                            if (faStoreService != null)
                                                            {
                                                                IsStoreSelected = faStoreService.Selected;
                                                            }

                                                            if (IsHomeSelected || IsStoreSelected)
                                                            {
                                                                    @:<a id="lnkClearItemType" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                            }
                                                        

                                                    <label class="fw-900 mt-15">SERVICE TYPE</label> 
                                                    <div class="custome-checkbox">

                                                    @if (faHomeService != null)
                                                        {
                                                            
                                                        //@Html.CheckBoxFor(model => model.StaticFacets.IsPickup, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbIsPickup", Name = "ckbIsPickup" }) 
                                                        //<label class="form-check-label" for="ckbIsPickup"><span>Pickup</span></label>
                                                        //<br />  

                                                                //<span class="pull-right badge badge-light round">@faHomeService.Count</span>
                                                                @Html.RadioButton("ckbFilterServiceTypeH", "1", faHomeService.Selected, new { @class = "form-check-input custom-control-input optServiceType", @Name = "optServiceType" })
                                                                //<label for="ckbFilterServiceTypeH" class="custom-control-label">Home Service</label>
                                                                <label class="form-check-label" for="ckbFilterServiceTypeH"><span>Home Service</span></label>
                                                                <br /> 
                                                        }
                                                        @if (faStoreService != null)
                                                        {
                                                            @Html.RadioButton("ckbFilterServiceTypeS", "2", faStoreService.Selected, new { @class = "form-check-input custom-control-input optServiceType", @Name = "optServiceType" })
                                                        //@Html.CheckBoxFor(model => model.StaticFacets.IsPickup, new { @class = "form-check-input custom-control-input ckbFilter", id = "ckbIsPickup", Name = "ckbIsPickup" }) 
                                                        <label class="form-check-label" for="ckbFilterServiceTypeS"><span>Store Service</span></label>
                                                        <br />  

                                                            //<div class="custom-control">
                                                            //    <span class="pull-right badge badge-light round">@faStoreService.Count</span>
                                                            //    @Html.RadioButton("ckbFilterServiceTypeS", "2", faStoreService.Selected, new { @class = "custom-control-input optServiceType", @Name = "optServiceType" })
                                                            //    <label for="ckbFilterServiceTypeS" class="custom-control-label">Store Service</label>
                                                            //</div> <!-- form-check.// -->
                                                        }


                                                    </div> 


                                                    <header class="card-header">
                                                        <h6 class="title">SERVICE TYPE</h6>
                                                    </header>
                                                    <div class="card-body">
                                                        
                                                        @if (faHomeService != null)
                                                        {
                                                            <div class="custom-control">
                                                                <span class="pull-right badge badge-light round">@faHomeService.Count</span>
                                                                @Html.RadioButton("ckbFilterServiceTypeH", "1", faHomeService.Selected, new { @class = "custom-control-input optServiceType", @Name = "optServiceType" })
                                                                <label for="ckbFilterServiceTypeH" class="custom-control-label">Home Service</label>
                                                            </div> <!-- form-check.// -->
                                                        }
                                                        @if (faStoreService != null)
                                                        {
                                                            <div class="custom-control">
                                                                <span class="pull-right badge badge-light round">@faStoreService.Count</span>
                                                                @Html.RadioButton("ckbFilterServiceTypeS", "2", faStoreService.Selected, new { @class = "custom-control-input optServiceType", @Name = "optServiceType" })
                                                                <label for="ckbFilterServiceTypeS" class="custom-control-label">Store Service</label>
                                                            </div> <!-- form-check.// -->
                                                        }
                                                    </div>
                                                }
                                            }
                                        }


                                }
                            }
                             
                                    
                                </div>
                            </div>
                            <a href="#" id="btnFilderDown"  onclick="SetDataInHiddenField()" class="btn btn-sm btn-default"><i class="fi-rs-filter mr-5"></i> Fillter</a>
                        </div>
                        <!-- Product sidebar Widget --> 
                    </div>
                </div>
        </div>



    <section class="stores-sec">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-left">
                    <ul class="nav navbar-nav filters">
                        
                        <li>
                            <a href="#">
                                <strong id="1" class="srgtxt">@Model.NumFound</strong><strong> @(Model.NumFound == 1 ? "ITEM" : "ITEMS") IN </strong>
                                <strong id="2" class="srgtxt">@Model.NGroups</strong><strong> @(Model.NGroups == 1 ? "STORE" : "STORES") </strong>
                            </a>
                        </li>
                    </ul>
                </div>
                @{
                    string sortLabel = "Relevence";
                    if (Model.OriginalQuery != null)
                    {
                        if (!string.IsNullOrWhiteSpace(Model.OriginalQuery.SortField))
                        {
                            if (Model.OriginalQuery.SortField.ToLower() == "price")
                            {
                                sortLabel = Model.OriginalQuery.SortDirection == "asc" ? "Price: Low to High" : "Price: High to Low";
                            }
                        }
                    }

                }
                <div class="navbar-right filters-right text-right">
                    <span>
                        <strong>SORT BY:</strong> &ensp;
                        <div class="btn-group">
                            <button type="button" class="form-control btn filter-dropdown btn-default dropdown-toggle" data-toggle="dropdown">
                                @sortLabel<span class="caret"></span>
                            </button>
                            <ul class="delivery-filter dropdown-menu" role="menu">
                                @if (sortLabel != "Price: Low to High")
                                {
                                    <li><a href="#" class="search-sort" data-sort-field="Price" data-sort-dir="asc">Price: Low to High</a></li>
                                }
                                @if (sortLabel != "Price: High to Low")
                                {
                                    <li><a href="#" class="search-sort" data-sort-field="Price" data-sort-dir="desc">Price: High to Low</a></li>
                                }
                                @if (sortLabel != "Relevence")
                                {
                                    <li><a href="#" class="search-sort" data-sort-field="Relevence" data-sort-dir="asc">Relevence</a></li>
                                }
                            </ul>
                        </div>
                    </span>
                </div>
            </nav>
        </div>
    </section>
    
    <section class="search__results">
        <div class="container">
            <div class="row">
                <aside class="col-sm-3">
                    <div class="card">
                        <article class="card-group-item">
                            @{
                                //bool isMultipleItemTypes = false;
                                if (Model.Facets != null)
                                {
                                    FacetsResponse faItemType = Model.Facets.FirstOrDefault(f => f.FacetEn == "ItemType");
                                    if (faItemType != null)
                                    {
                                        if (faItemType.FacetFilters.Count > 1)
                                        {
                                            isMultipleItemTypes = true;
                                            FacetItem faProducts = faItemType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "P");
                                            FacetItem faServices = faItemType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "S");
                                                <header class="card-header">
                                                    <h6 class="title">ITEM TYPE</h6>
                                                </header>
                                                <div class="card-body">
                                                    @if (faProducts != null)
                                                {
                                                    if (faServices != null)
                                                    {
                                                        if (faProducts.Selected || faServices.Selected)
                                                        {
                                                                @:<a id="lnkClearItemType" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                        }
                                                    }
                                                        <div class="custom-control">
                                                            <span class="pull-right badge badge-light round">@faProducts.Count</span>
                                                            @Html.RadioButton("ckbFilterItemTypeP", faProducts.FacetText, faProducts.Selected, new { @class = "custom-control-input optItemType", @Name = "optItemType" })
                                                            <label for="ckbFilterItemTypeP" class="custom-control-label">Products</label>
                                                        </div> <!-- form-check.// -->
                                                }
                                                    @if (faServices != null)
                                                {
                                                        <div class="custom-control">
                                                            <span class="pull-right badge badge-light round">@faServices.Count</span>
                                                            @Html.RadioButton("ckbFilterItemTypeS", faServices.FacetText, faServices.Selected, new { @class = "custom-control-input optItemType", @Name = "optItemType" })
                                                            <label for="ckbFilterItemTypeS" class="custom-control-label">Services</label>
                                                        </div> <!-- form-check.// -->
                                                }
                                                </div>
                                        }
                                    }
                                }
                            }
                            @{
                                if (Model.Facets != null)
                                {
                                    List<FacetsResponse> lstDynamicFacets = Model.Facets.Where(f => f.FacetEn == "ManufacturerEn" || f.Id != 0).ToList();
                                    for (int i = 0; i < lstDynamicFacets.Count; i++)
                                    {
                                            <header class="card-header">
                                                <h6 class="title">@(lstDynamicFacets[i].FacetEn == "ManufacturerEn" ? "BRAND" : lstDynamicFacets[i].FacetEn.ToUpper())</h6>
                                            </header>
                                            <div class="card-body">
                                                @{
                                                FacetsResponse currentFacetFilters = null;

                                                if (lstDynamicFacets[i].FacetEn == "ManufacturerEn")
                                                {
                                                    currentFacetFilters = Model.Facets.FirstOrDefault(f => f.FacetEn == lstDynamicFacets[i].FacetEn);
                                                }
                                                else
                                                {
                                                    currentFacetFilters = Model.Facets.FirstOrDefault(f => f.Id == lstDynamicFacets[i].Id);
                                                }

                                                if (currentFacetFilters != null)
                                                {
                                                    if (currentFacetFilters.FacetFilters.Any(ff => ff.Selected == true))
                                                    {
                                                                @:<a id="@string.Concat("lknClear_", lstDynamicFacets[i].Id)" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                    }
                                                }
                                                }
                                                @foreach (var facetFilterItems in currentFacetFilters.FacetFilters)
                                            {
                                                    <div class="custom-control custom-checkbox">
                                                        <span class="pull-right badge badge-light round">@facetFilterItems.Count</span>
                                                        @Html.CheckBox(string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId), facetFilterItems.Selected, new { @class = "custom-control-input ckbFilter filter-auto" })
                                                        <label for="@string.Concat("ckbFilter", Model.Facets[i].Id, "_", facetFilterItems.FacetTextId)" class="custom-control-label">@(facetFilterItems.FacetText.ToTitleCase())</label>
                                                    </div> <!-- form-check.// -->
                                            }
                                            </div>
                                    }
                                }
                            }
                            @if (Model.Results != null)
                            {
                                if (Model.OriginalResultsCount > 0)
                                {
                                    <header class="card-header">
                                        <h6 class="title">PRICE</h6>
                                    </header>
                                    <div class="card-body">
                                        @if (Model.MinPrice + "," + Model.MaxPrice != Model.OriginalPriceRange)
                                        {
                                            <a id="lnkClearPriceFilter" href="javascript:void(0)">Clear</a>
                                        }
                                        <input id="txtPriceRange" type="text" data-slider-min="@Model.MinPrice" data-slider-max="@Model.MaxPrice" data-slider-value="[@Model.OriginalPriceRange]" />
                                        <div>
                                            Min: <span id="spnMinPrice" />
                                            <span class="pull-right">Max: <span id="spnMaxPrice" /></span>
                                        </div>
                                    </div>
                                    <header class="card-header">
                                        <h6 class="title">PAYMENT METHOD</h6>
                                    </header>
                                    <div class="card-body">
                                        <div class="custom-control custom-checkbox">
                                            @Html.CheckBoxFor(model => model.StaticFacets.IsCOD, new { @class = "custom-control-input ckbFilter", id = "ckbPaymentCOD", Name = "ckbPaymentCOD" })
                                            <label for="ckbPaymentCOD" class="custom-control-label">Cash On Delivery</label>
                                        </div> <!-- form-check.// -->
                                    </div>
                                    <header class="card-header">
                                        <h6 class="title">CREDIT CARD</h6>
                                    </header>
                                    <div class="card-body">
                                        <div class="custom-control custom-checkbox">
                                            @Html.CheckBoxFor(model => model.StaticFacets.IsCCPN, new { @class = "custom-control-input ckbFilter", id = "ckbPaymentCrPayNow", Name = "ckbPaymentCrPayNow" })
                                            <label for="ckbPaymentCrPayNow" class="custom-control-label">Pay Now</label>
                                        </div> <!-- form-check.// -->
                                        <div class="custom-control custom-checkbox">
                                            @Html.CheckBoxFor(model => model.StaticFacets.IsCCPL, new { @class = "custom-control-input ckbFilter", id = "ckbPaymentCrPayLater", Name = "ckbPaymentCrPayLater" })
                                            <label for="ckbPaymentCrPayLater" class="custom-control-label">Pay Later</label>
                                        </div> <!-- form-check.// -->
                                    </div>
                                    <header class="card-header">
                                        <h6 class="title">DEBIT CARD</h6>
                                    </header>
                                    <div class="card-body">
                                        <div class="custom-control custom-checkbox">
                                            @Html.CheckBoxFor(model => model.StaticFacets.IsDCPN, new { @class = "custom-control-input ckbFilter", id = "ckbPaymentDrPayNow", Name = "ckbPaymentDrPayNow" })
                                            <label for="ckbPaymentDrPayNow" class="custom-control-label">Pay Now</label>
                                        </div> <!-- form-check.// -->
                                        <div class="custom-control custom-checkbox">
                                            @Html.CheckBoxFor(model => model.StaticFacets.IsDCPL, new { @class = "custom-control-input ckbFilter", id = "ckbPaymentDrPayLater", Name = "ckbPaymentDrPayNow" })
                                            <label for="ckbPaymentDrPayLater" class="custom-control-label">Pay Later</label>
                                        </div> <!-- form-check.// -->
                                    </div>
                                    {
                                        bool IsDeliveryType = true; bool IsServiceType = false;

                                        if (!isMultipleItemTypes)
                                        {
                                            if (Model.Results.Count > 0)
                                            {
                                                if (Model.Results[0].ItemType == "S")
                                                {
                                                    IsServiceType = true;
                                                    IsDeliveryType = false;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            IsServiceType = true;
                                        }

                                        if (!string.IsNullOrWhiteSpace(Model.StaticFacets.ItemType))
                                        {
                                            IsDeliveryType = Model.StaticFacets.ItemType != "S";
                                            IsServiceType = !IsDeliveryType;
                                        }

                                        if (IsDeliveryType)
                                        {
                                            <header class="card-header">
                                                <h6 class="title">DELIVERY</h6>
                                            </header>
                                            <div class="card-body">
                                                <div class="custom-control custom-checkbox">
                                                    @Html.CheckBoxFor(model => model.StaticFacets.IsPickup, new { @class = "custom-control-input ckbFilter", id = "ckbIsPickup", Name = "ckbIsPickup" })
                                                    <label for="ckbIsPickup" class="custom-control-label">Pickup</label>
                                                </div> <!-- form-check.// -->
                                                <div class="custom-control custom-checkbox">
                                                    @Html.CheckBoxFor(model => model.StaticFacets.IsDelivery, new { @class = "custom-control-input ckbFilter", id = "ckbIsDelivery", Name = "ckbIsDelivery" })
                                                    <label for="ckbIsDelivery" class="custom-control-label">Delivery</label>
                                                </div> <!-- form-check.// -->
                                                <div class="custom-control custom-checkbox">
                                                    @Html.CheckBoxFor(model => model.StaticFacets.IsShipping, new { @class = "custom-control-input ckbFilter", id = "ckbIsShipping", Name = "ckbIsShipping" })
                                                    <label for="ckbIsShipping" class="custom-control-label">Shipping</label>
                                                </div> <!-- form-check.// -->
                                            </div>
                                        }

                                        if (IsServiceType)
                                        {
                                            FacetsResponse faServiceType = Model.Facets.FirstOrDefault(f => f.FacetEn == "ServiceType");
                                            if (faServiceType != null)
                                            {
                                                //To dynamically dispaly service type filters
                                                if (faServiceType.FacetFilters.Where(ff => ff.FacetText != "0").Count() > 0)
                                                {
                                                    FacetItem faHomeService = faServiceType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "1");
                                                    FacetItem faStoreService = faServiceType.FacetFilters.FirstOrDefault(ff => ff.FacetText == "2");

                                                    <header class="card-header">
                                                        <h6 class="title">SERVICE TYPE</h6>
                                                    </header>
                                                    <div class="card-body">
                                                        @{
                                                            bool IsHomeSelected = false; bool IsStoreSelected = false;
                                                            if (faHomeService != null)
                                                            {
                                                                IsHomeSelected = faHomeService.Selected;
                                                            }
                                                            if (faStoreService != null)
                                                            {
                                                                IsStoreSelected = faStoreService.Selected;
                                                            }

                                                            if (IsHomeSelected || IsStoreSelected)
                                                            {
                                                                    @:<a id="lnkClearItemType" class="clear-filters" href="javascript:void(0)">Clear</a>
                                                            }
                                                        }
                                                        @if (faHomeService != null)
                                                        {
                                                            <div class="custom-control">
                                                                <span class="pull-right badge badge-light round">@faHomeService.Count</span>
                                                                @Html.RadioButton("ckbFilterServiceTypeH", "1", faHomeService.Selected, new { @class = "custom-control-input optServiceType", @Name = "optServiceType" })
                                                                <label for="ckbFilterServiceTypeH" class="custom-control-label">Home Service</label>
                                                            </div> <!-- form-check.// -->
                                                        }
                                                        @if (faStoreService != null)
                                                        {
                                                            <div class="custom-control">
                                                                <span class="pull-right badge badge-light round">@faStoreService.Count</span>
                                                                @Html.RadioButton("ckbFilterServiceTypeS", "2", faStoreService.Selected, new { @class = "custom-control-input optServiceType", @Name = "optServiceType" })
                                                                <label for="ckbFilterServiceTypeS" class="custom-control-label">Store Service</label>
                                                            </div> <!-- form-check.// -->
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        </article> <!-- card-group-item.// -->
                    </div> <!-- card.// -->
                </aside><!-- end col-sm-3-->
                <main id="searchResultItems" class="col-sm-9">
                    @if (Model.Results != null)
                    {
                        for (int i = 0; i < Model.Results.Count; i++)
                        {
                            if (i % 3 == 0)
                            {
                                @:<div class="row">
                                }
                                <div class="col-sm-4">
                                    <figure class="card card-product">
                                        <div class="img-wrap">
                                            <img class="img-responsive" src="@Url.Content(strApiURL + "Uploads/Products/" + Model.Results[i].ProductMainImage)">
                                        </div>
                                        <figcaption class="product-desc">
                                            <h4 class="title">@Model.Results[i].NameEn</h4>
                                            <div class="rating-wrap">
                                                @*<ul class="rating-stars">
                                                        <li style="width:80%" class="stars-active">
                                                            <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                                        </li>
                                                    </ul>*@
                                                <div class="label-rating">@Model.Results[i].StoreNameEn</div>
                                                <div class="label-rating">
                                                    @Model.Results[i].BranchNameEn
                                                    @(Model.Results[i].DistToStoreBranch != null ? string.Concat(Math.Round(Convert.ToDecimal(Model.Results[i].DistToStoreBranch), 2).ToString(), " km") : "")
                                                    @*@Model.Results[i].ItemType*@
                                                    <br />
                                                    @*@Model.Results[i].ServiceType*@@*@Model.Results[i].ServiceType*@@*@Model.Results[i].ServiceType*@@*@Model.Results[i].ServiceType*@@*@Model.Results[i].ServiceType*@@*@Model.Results[i].ServiceType*@
                                                </div>
                                            </div> <!-- rating-wrap.// -->
                                        </figcaption>
                                        <div class="product-price">
                                            @*@if (Model.Results[i].ItemType.ToUpper() == "P")
                                            {
                                                <a href="@Url.Action("ProductDetails", "CustomerProducts", new { Id = SlugUtil.GenerateSlug(Model.Results[i].ProductBranchId, Model.Results[i].NameEn, Model.Results[i].ProductSKUId, Convert.ToInt32(Model.Results[i].ProductId), Model.Results[i].UPCBarcode) })" class="btn btn-sm btn-primary btn-main pull-left">View Details</a>
                                            }
                                            else
                                            {
                                                <a href="@Url.Action("ServiceDetails", "CustomerServices", new { Id = SlugUtil.GenerateSlugService(Model.Results[i].NameEn,Model.Results[i].BranchId,Convert.ToInt32(Model.Results[i].ProductId))})" class="btn btn-sm btn-primary btn-main pull-left">View Details</a>
                                            }*@
                                            @{
                                                var MainCategory = Model.Results[i].OtherFields.Where(x => x.Key == "BranchCategoryEn").Select(x => x.Value).First().ToString();
                                                var SubCategory = Model.Results[i].OtherFields.Where(x => x.Key == "BranchSubCategoryEn").Select(x => x.Value).First().ToString();//dictionary.Where(x => someKeys.Contains(x.Key)).Select(x => x.Value);
                                             }
                                            @if (Model.Results[i].ItemType.ToUpper() == "P")
                                            {
                                                <a href="~/@Model.Results[i].StoreNameEn.Replace(" ","-").ToLower()/@MainCategory.Replace(" ","-").ToLower()/@SubCategory.Replace(" ","-").ToLower()/p/@SlugUtil.GenerateSlug(Model.Results[i].ProductBranchId, Model.Results[i].NameEn, Model.Results[i].ProductSKUId, Convert.ToInt32(Model.Results[i].ProductId), Model.Results[i].UPCBarcode,Model.Results[i].BranchId)" class="btn btn-sm btn-primary btn-main pull-left">View Details</a>
                                            }
                                            else
                                            {
                                                <a href="~/@Model.Results[i].StoreNameEn.Replace(" ","-").ToLower()/@MainCategory.Replace(" ","-").ToLower()/@SubCategory.Replace(" ","-").ToLower()/s/@SlugUtil.GenerateSlugService(Model.Results[i].NameEn,Model.Results[i].BranchId,Convert.ToInt32(Model.Results[i].ProductId))" class="btn btn-sm btn-primary btn-main pull-left">View Details</a>
                                            }
                                            <div class="price-wrap">
                                                <span class="price-new">@Model.Results[i].Price.ToString("#,###,###,##0.00") SAR</span>
                                                <del class="price-old">@Model.Results[i].SellingPrice.ToString("#,###,###,##0.00") SAR</del>
                                            </div> <!-- price-wrap.// -->
                                        </div> <!-- product-price.// -->
                                    </figure>
                                </div> <!-- col // -->
                                if (i % 3 == 2)
                                {
                                @:</div><!-- row.// -->
                            }
                        }
                        if (Model.Results.Count == 0)
                        {
                            <div class="row">
                                <div class="col-sm-12">
                                    No Results matching your search criteria
                                </div>
                            </div>
                        }
                    }
                    <div class="row">
                        <div class="col-sm-12">
                            <ul class="pagination">
                                @{
                                    //int iPageSize = Customer.Utils.SearchUtil.PageSize;
                                    //int iMaxPages = (Model.NGroups + iPageSize - 1) / iPageSize;
                                    ///if (iMaxPages > 1)
                                    //{
                                    for (int i = 1; i <= iMaxPages; i++)
                                    {
                                            <li><a href="javascript:void(0);" class="changePage" data-pageindex="@(i - 1)">@i</a></li>
                                    }
                                    //}
                                }
                            </ul>
                        </div>
                    </div>
                    @*<div id="divResultsAJAXLoader" class="row" style="display:none">
                            <div class="col-sm-12">
                                <div class="loading-wrapper">
                                    <div class="lds-ring">
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                    </div>
                                </div>
                            </div>
                        </div>*@
                </main><!-- end col-sm-9-->
            </div> <!-- end row -->
        </div><!-- end container-->
    </section><!-- end search__results-->


}
<script>
  // Slider Range JS
    if ($("#slider-range").length) {
        $(".noUi-handle").on("click", function () {
            $(this).width(50);
        });
        var rangeSlider = document.getElementById("slider-range");
        var moneyFormat = wNumb({
            decimals: 0,
            thousand: ",",
            prefix: "SAR "
        });
        noUiSlider.create(rangeSlider, {
            start: [0, @(Math.Ceiling( maxPrice))],
            step: 1,
            range: {
                //min: [@(Math.Floor( minPrice))],
                min: [0],
                max: [@(Math.Ceiling( maxPrice))]
            },
            format: moneyFormat,
            connect: true
        });

        // Set visual min and max values and also update value hidden form inputs
        rangeSlider.noUiSlider.on("update", function (values, handle) {
            console.log ("Values: "+values[0]+" "+values[1]);
            document.getElementById("slider-range-value1").innerHTML = values[0];
            document.getElementById("slider-range-value2").innerHTML = values[1];
            document.getElementsByName("min-value").value = moneyFormat.from(values[0]);
            document.getElementsByName("max-value").value = moneyFormat.from(values[1]);
        });
    }
</script>